#!/bin/bash
#SBATCH --job-name=_384__1
#SBATCH -D ./
#SBATCH --ntasks=1
#SBATCH --output=benchmarks/definitive_results/replication/gpu_metrics/opt-2.7b_chunked/_384__1/log_%j.out
#SBATCH --error=benchmarks/definitive_results/replication/gpu_metrics/opt-2.7b_chunked/_384__1/log_%j.err
#SBATCH --cpus-per-task=20
#SBATCH --gres gpu:1
#SBATCH --time=00:25:00
module load singularity
singularity exec --nv --env PYTHONPATH=. --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/core:/usr/local/lib/python3.12/dist-packages/vllm/core --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/engine:/usr/local/lib/python3.12/dist-packages/vllm/engine --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/entrypoints:/usr/local/lib/python3.12/dist-packages/vllm/entrypoints --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/executor:/usr/local/lib/python3.12/dist-packages/vllm/executor --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/lora:/usr/local/lib/python3.12/dist-packages/vllm/lora --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/model_executor:/usr/local/lib/python3.12/dist-packages/vllm/model_executor --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/worker:/usr/local/lib/python3.12/dist-packages/vllm/worker --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/config.py:/usr/local/lib/python3.12/dist-packages/vllm/config.py --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/sequence.py:/usr/local/lib/python3.12/dist-packages/vllm/sequence.py --bind /gpfs/home/bsc/bsc098069/llm_benchmarking/vLLMServingPlateau/vllm/outputs.py:/usr/local/lib/python3.12/dist-packages/vllm/outputs.py /gpfs/scratch/bsc98/bsc098069/llm_benchmarking/images/vllm-benchmark-default-nsight.sif nsys profile --output benchmarks/definitive_results/replication/gpu_metrics/opt-2.7b_chunked/_384__1/ --gpu-metrics-devices all --cuda-graph-trace node --trace nvtx python3 benchmarks/benchmark_serving_with_metrics.py --port='60563' --result-dir='benchmarks/definitive_results/replication/gpu_metrics/opt-2.7b_chunked/_384__1' --disable-log-stats --backend='openai' --disable-tqdm --dataset-path='/gpfs/scratch/bsc98/bsc098069/llm_benchmarking/data/ShareGPT_V3_unfiltered_cleaned_split.json' --endpoint='/v1/completions' --model='/gpfs/scratch/bsc98/bsc098069/llm_benchmarking/models/opt/opt-2.7b/' --save-result --num-prompts='2000' --include-nvtx-regions --multiple-servers='1' --launch-server --server-args='--disable-log-requests --disable-log-stats --model=/gpfs/scratch/bsc98/bsc098069/llm_benchmarking/models/opt/opt-2.7b/ --max-model-len=2048 --enable-chunked-prefill --max-num-batched-tokens=2048 --max-num-seqs='384''